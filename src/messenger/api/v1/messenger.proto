syntax = "proto3";

package v1;

message TypedMessage {
  string type = 1;
  bytes value = 2;
}

message SignedMessage {
  TypedMessage message = 1;
  string signature = 2;
}

message GetRSAPublicKeyRequest {
}

message GetRSAPublicKeyResponse {
  string key = 1;
}

message GetDHParametersRequest {
}

message GetDHParametersResponse {
  string p = 1;
  int32 g = 2;
  string q = 3;
}

message GetDHPublicKeyRequest {
}

message GetDHPublicKeyResponse {
  string y = 1;
}

message RegisterRequest {
  string id = 1;
  string password_ciphertext = 2;
}

message RegisterResponse {
}

message LoginRequest {
  string id = 1;
  string password_ciphertext = 2;
  string dh_public_key_y = 3;
}

message LoginResponse {
}

service MessengerService {
  rpc GetRSAPublicKey(GetRSAPublicKeyRequest) returns (GetRSAPublicKeyResponse);

  rpc GetDHParameters(GetDHParametersRequest) returns (SignedMessage);

  rpc GetDHPublicKey(GetDHPublicKeyRequest) returns (SignedMessage);

  rpc Register(RegisterRequest) returns (RegisterResponse);

  rpc StartSession(stream TypedMessage) returns (stream SignedMessage);
}
